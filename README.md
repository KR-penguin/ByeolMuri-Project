# 🌟 광학 퍼즐 게임 - 맵 에디터

## 📁 프로젝트 구조

```
ByeolMuri/
├── tool..py           # 메인 실행 파일 (맵 에디터)
├── objects.py         # 게임 오브젝트 클래스 정의
├── utils.py           # 수학/물리 유틸리티 함수
├── OPTIMIZATION.md    # 성능 최적화 제안사항
├── saved_map.json     # 저장된 맵 파일
└── README.md          # 이 파일
```

---

## 🎮 주요 기능

### ✨ 맵 제작 기능
- **오브젝트 배치**: 발사장치, 목표지점, 거울, 렌즈, 프리즘, 블랙홀
- **각도 조절**: 마우스 휠로 오브젝트 회전 (360°)
- **지우개 모드**: 오브젝트 삭제
- **저장/불러오기**: JSON 형식으로 맵 저장

### 🔬 물리 시뮬레이션
- **스넬의 법칙(Snell's Law)** 기반 굴절 계산
- **전반사(Total Internal Reflection)** 구현
- **프리즘 분광**: RGB 색상 분리
- **거울 반사**: 정확한 반사각 계산

### 🎯 굴절률 설정 (NEW!)
- **맵별 굴절률 설정**: `n +` / `n -` 버튼으로 조절 (1.0 ~ 3.0)
- **렌즈가 맵 설정을 따름**: 배치된 모든 렌즈가 동일한 굴절률 사용
- **플레이어 참고용**: 화면에 굴절률과 스넬의 법칙 공식 표시

---

## 🚀 실행 방법

### 요구사항
```bash
pip install pygame
```

### 실행
```bash
python tool..py
```

---

## 🎨 사용 방법

### 1️⃣ 오브젝트 배치
1. 상단 버튼에서 원하는 오브젝트 선택
2. 맵 영역을 클릭하여 배치
3. 마우스 휠로 각도 조절 (발사장치, 거울, 렌즈, 프리즘)

### 2️⃣ 굴절률 설정
- `n +` 버튼: 굴절률 증가 (+0.1)
- `n -` 버튼: 굴절률 감소 (-0.1)
- 현재 굴절률은 화면 상단에 표시

### 3️⃣ 시뮬레이션
- `게임 시작` 버튼: 빛의 경로 시뮬레이션 시작
- `중단` 버튼: 시뮬레이션 정지
- `클리어` 버튼: 모든 오브젝트 삭제

### 4️⃣ 저장/불러오기
- `맵 저장`: 맵 번호 입력 → `level_[번호].json`으로 저장
  - **저장 내용**: 모든 오브젝트 (발사장치, 목표지점, 거울, 렌즈, 프리즘, 블랙홀) + 굴절률
- `맵 불러오기`: 맵 번호 입력 → 해당 레벨 전체 불러오기
  - **초기화**: 모든 오브젝트가 저장된 상태로 복원됨

---

## 📐 물리 법칙

### 스넬의 법칙 (Snell's Law)
$$n_1 \sin(\theta_1) = n_2 \sin(\theta_2)$$

- $n_1$: 입사 매질의 굴절률 (공기 = 1.0)
- $n_2$: 굴절 매질의 굴절률 (맵 설정값)
- $\theta_1$: 입사각
- $\theta_2$: 굴절각

### 전반사 조건
$$\left|\frac{n_1}{n_2} \sin(\theta_1)\right| > 1$$

전반사 발생 시 빛이 반사됨.

---

## 🎯 게임 오브젝트

| 오브젝트 | 아이콘 | 기능 |
|---------|-------|------|
| **발사장치** | ⭕ (원 + 화살표) | 빛 발사 (흰/빨/초/파) |
| **목표지점** | ⭕ (원 테두리) | 특정 색상 빛 도달 시 클리어 |
| **거울** | ━ (선) | 빛 반사 |
| **렌즈** | 🔵 (파란 원) | 빛 굴절 (맵 굴절률 사용) |
| **프리즘** | 🔺 (삼각형) | 빛 분광 (RGB 분리) |
| **블랙홀** | ⚫ (검은 원) | 빛 흡수 |

---

## 📦 파일별 역할

### `tool..py` (메인 파일)
- pygame 초기화 및 메인 루프
- UI 버튼 관리
- 이벤트 처리 (클릭, 휠)
- 빛 시뮬레이션 실행
- 맵 저장/불러오기

### `objects.py` (오브젝트 클래스)
- `Button`: UI 버튼
- `Emitter`: 빛 발사 장치
- `Target`: 목표 지점
- `Mirror`: 거울
- `Lens`: 렌즈 (맵 굴절률 사용)
- `Prism`: 프리즘
- `Blackhole`: 블랙홀

### `utils.py` (유틸리티 함수)
- `near()`: 충돌 감지
- `angle_wrap()`: 각도 정규화
- `refract_angle()`: 스넬의 법칙 계산
- `advance()`: 벡터 이동

---

## 🔧 코드 개선사항

### ✅ 완료된 개선
1. **모듈화**: 클래스와 유틸리티 함수 분리
2. **굴절률 설정**: 맵별 굴절률 조절 기능 추가
3. **렌즈 개선**: 맵 설정을 따르도록 변경
4. **JSON 저장**: 굴절률 정보 포함

### 📝 최적화 제안 (OPTIMIZATION.md 참고)
- 공간 분할 (Spatial Partitioning)
- 레이어 분리 (정적 오브젝트 캐싱)
- 빛 경로 캐싱
- 삼각함수 계산 최적화
- 버튼 매니저 패턴

---

## 🎓 학습 포인트

플레이어는 **스넬의 법칙**을 이해하고, 주어진 굴절률(n)을 보고 계산하여 퍼즐을 풀게 됩니다.

**예시:**
- 맵 굴절률: n = 1.5
- 공기 → 렌즈: $1.0 \times \sin(30°) = 1.5 \times \sin(\theta_2)$
- $\theta_2 = \arcsin(0.333) \approx 19.5°$

---

## 📄 라이선스

MIT License

---

## 👨‍💻 개발자

퍼즐 게임 기획자를 위한 맵 에디터 툴

**제작:** GitHub Copilot + KoreaPenguin  
**날짜:** 2025년 10월 20일
